<?xml version="1.0" encoding="UTF-8"?>
<seiscomp>
	<module name="scrtdd" category="Processing" inherit-global-bindings="true">
		<description>Real Time Double-Difference location module.</description>
		<configuration>

			<group name="rtdd">

				<parameter name="publicIDpattern" type="string" default="RTDD.@time/%Y%m%d%H%M%S.%f@.@id@">
					<description>
						PublicID creation pattern for an origin created by RTDD.
					</description>
				</parameter>

				<parameter name="activeProfiles" type="list:string">
					<description>
						Defines a list of active profiles.
					</description>
				</parameter>

				<parameter name="outputPath" type="path" default="/tmp/rtdd">
					<description>
						Defines the directory used for storing processing input and output files.
					</description>
				</parameter>

				<parameter name="manualOrigin" type="boolean" default="true">
					<description>
					Enables relocation of any manual origin. If false, only event preferred origins are relocated.
					</description>
				</parameter>

				<group name="cron">

					<parameter name="wakeupInterval" type="int" unit="s" default="10">
						<description>
						Specifies the interval in seconds to check/start scheduled operations.
						</description>
					</parameter>

					<parameter name="delayTimes" type="list:int" default="60,120,300,600,3600">
						<description>
						Specifies a list of delay times in seconds relative to event time
						to trigger the processing. When the first origin of an event arrives
						this list is used to construct the crontab for this event.
						Example: &quot;60, 120, 300, 3600&quot;
						</description>
					</parameter>

					<parameter name="updateDelay" type="int" default="60">
						<description>
						Specifies the delay in seconds to delay processing if a new
						authoritative origin arrives for an event.
						</description>
					</parameter>

					<parameter name="eventMaxIdleTime" type="int" unit="s" default="3600">
						<description>
						Specifies the maximum allowed idle time of a process before removed.
						The idle time is calculated if no further processing is scheduled
						and computes as: [now]-lastRun.
						</description>
					</parameter>

					<parameter name="logging" type="boolean" default="true">
						<description>
						Enables/disables updating of a cron log file. This file will be
						created at ~/.seiscomp3/log/[appname].sched
						and contains information about the scheduled events and the
						processing queue. The file is updated each n seconds,
						where n = rtdd.cron.wakeupInterval.
						</description>
					</parameter>

				</group>

				<group name="profile">
					<struct type="rtdd profile" link = "rtdd.activeProfiles">
						<description>
							Defines a regional profile that is used if a prelocation falls
							inside the configured region. If an origin prelocation falls in multiple
							profile regions, then the profile with the area center closer to the
							origin location will be used.
						</description>

						<parameter name="regionType" type="string">
							<description>
								Type of region: RECTANGLE or CIRCLE
							</description>
						</parameter>

						<parameter name="region" type="list:double">
							<description>
								Defines the region values. If regionType is RECTANGLE then 4 values
								(min_lat, min_lon, max_lat, max_lon) are expected. If regionType
								is CIRCLE then 3 values are expected (lat, lon, radius in km).
								If region is empty, then it will represent a region that matches any
								origin.
							</description>
						</parameter>

						<parameter name="earthModelID" type="string">
							<description>
								earthModelID that is stored in the created origin.
							</description>
						</parameter>

						<parameter name="methodID" type="string">
							<description>
								methodID that is stored in the created origin.
							</description>
						</parameter>

						<group name="catalog">
							<description>
								The file used to define a catalog must be in csv format.
								The first line must contains the compulsory column names, which
								can appear in any order. Also the header might contains
								additional headers, which will not be used by this module but
								can be there for informationl purpose.
							</description>

							<parameter name="eventFile" type="path">
								<description>
									Path to event file to be used for this profile.
									Required columns: id,isotime,latitude,longitude,depth,magnitude,horiz_err,depth_err,tt_residual
									Alternative columns: seiscompId (this must be a valide seiscomp3 origin id or event id)
									If the alternative format is used, then no phase or station file are required as
									all the information will be fetched from the database.
								</description>
							</parameter>

							<parameter name="phaFile" type="path">
								<description>
									Path to catalog picks file to be used for this profile
									Required columns: eventId,stationId,isotime,weight,type,networkcode,stationcode,locationCode,channelCode
								</description>
							</parameter>

							<parameter name="stationFile" type="path">
								<description>
									Path to the stations file to be used for this profile
									Required columns: id,latitude,longitude,elevation,networkcode,stationcode
								</description>
							</parameter>
						</group>

						<group name="dtct">
							<description>
								Differential travel time computation options.
							</description>
							<parameter name="minWeight" type="double">
								<description>Min phase weight allowed</description>
							</parameter>
							<parameter name="maxESdist" type="double">
								<description>Max epi-sta distance allowed (km)</description>
							</parameter>
							<parameter name="maxIEdist" type="double">
								<description>Max interevent-distance allowed (km)</description>
							</parameter>
							<parameter name="minNumNeigh" type="int">
								<description>Min neighbors required</description>
							</parameter>
							<parameter name="maxNumNeigh" type="int">
								<description>Max neighbors allowed (furthest events are discarded)</description>
							</parameter>
							<parameter name="minDTperEvt" type="int">
								<description>Min dt per event pair required ((Including P+S)</description>
							</parameter>
						</group>

						<group name="dtcc">
							<description>
								Cross-correlation differential travel time computation options.
							</description>
							<parameter name="minWeight" type="double">
								<description>Min phase weight allowed</description>
							</parameter>
							<parameter name="maxESdist" type="double">
								<description>Max epi-sta distance allowed (km)</description>
							</parameter>
							<parameter name="maxIEdist" type="double">
								<description>Max interevent-distance allowed (km)</description>
							</parameter>
							<parameter name="minNumNeigh" type="int">
								<description>Min neighbors required</description>
							</parameter>
							<parameter name="maxNumNeigh" type="int">
								<description>Max neighbors allowed (furthest events are discarded)</description>
							</parameter>
							<parameter name="minDTperEvt" type="int">
								<description>Min dt per event pair required ((Including P+S)</description>
							</parameter>
							<parameter name="minCCCoef" type="double">
								<description>Min crosscorrelation coefficient required</description>
							</parameter>
							<group name="crosscorrelation">
								<parameter name="filterFmin" type="double">
									<description>Frequency of the hi-pass filter (hz, 0 disable)</description>
								</parameter>
								<parameter name="filterFmax" type="double">
									<description>Frequency of the low-pass filter (hz, 0 disable)</description>
								</parameter>
								<parameter name="filterFsamp" type="double">
									<description>Samplig rate (hz, 0 disable)</description>
								</parameter>
								<parameter name="filterOrder" type="int">
									<description>Filter order</description>
								</parameter>
								<parameter name="timeBeforePick" type="double">
									<description>(secs)</description>
								</parameter>
								<parameter name="timeAfterPick" type="double">
									<description>(secs)</description>
								</parameter>
								<parameter name="maxDelay" type="double">
									<description>(secs)</description>
								</parameter>
							</group>
						</group>

						<group name="hypodd">
							<parameter name="execPath" type="path" default="hypodd">
								<description>
									Path to hypodd executable.
								</description>
							</parameter>

							<parameter name="controlFile" type="path">
								<description>
									Control file of the current profile. If not set, the default
									control file will be used instead.
								</description>
							</parameter>
						</group>

						<group name="ph2dt">
							<description>
								This configuration is used only for full catalog relocation and it is
								not useful in real time DD relocation.
								See command line option --relocate-catalog
							</description>

							<parameter name="execPath" type="path" default="ph2dt">
								<description>
									Path to ph2dt executable.
								</description>
							</parameter>
							<parameter name="minwght" type="double">
								<description>Min. pick weight allowed.</description>
							</parameter>
							<parameter name="maxdist" type="double">
								<description>Max. distance in km between event pair and stations. </description>
							</parameter>
							<parameter name="maxsep" type="double">
								<description>Max. hypocentral separation in km</description>
							</parameter>
							<parameter name="maxngh" type="int">
								<description>Max. number of neighbors per event. </description>
							</parameter>
							<parameter name="minlnk" type="int">
								<description>Min. number of links required to define a neighbor</description>
							</parameter>
							<parameter name="minobs" type="int">
								<description>Min. number of links per pair saved</description>
							</parameter>
							<parameter name="maxobs" type="int">
								<description>Max. number of links per pair saved</description>
							</parameter>
						</group>

					</struct>
				</group>

			</group>

		</configuration>
		<command-line>
			<group name="Generic">
				<optionReference>generic#help</optionReference>
				<optionReference>generic#version</optionReference>
				<optionReference>generic#config-file</optionReference>
				<optionReference>generic#plugins</optionReference>
				<optionReference>generic#daemon</optionReference>
				<optionReference>generic#auto-shutdown</optionReference>
				<optionReference>generic#shutdown-master-module</optionReference>
				<optionReference>generic#shutdown-master-username</optionReference>
			</group>
			
			<group name="Verbosity">
				<optionReference>verbosity#verbosity</optionReference>
				<optionReference>verbosity#v</optionReference>
				<optionReference>verbosity#quiet</optionReference>
				<optionReference>verbosity#component</optionReference>
				<optionReference>verbosity#syslog</optionReference>
				<optionReference>verbosity#lockfile</optionReference>
				<optionReference>verbosity#console</optionReference>
				<optionReference>verbosity#debug</optionReference>
				<optionReference>verbosity#log-file</optionReference>
			</group>
			
			<group name="Messaging">
				<optionReference>messaging#user</optionReference>
				<optionReference>messaging#host</optionReference>
				<optionReference>messaging#timeout</optionReference>
				<optionReference>messaging#primary-group</optionReference>
				<optionReference>messaging#subscribe-group</optionReference>
				<optionReference>messaging#encoding</optionReference>
				<optionReference>messaging#start-stop-msg</optionReference>
			</group>
			
			<group name="Database">
				<optionReference>database#db-driver-list</optionReference>
				<optionReference>database#database</optionReference>
				<optionReference>database#config-module</optionReference>
				<optionReference>database#inventory-db</optionReference>
				<optionReference>database#db-disable</optionReference>
			</group>

			<group name="Mode">

				<option long-flag="test">
					<description>Test mode, no messages are sent</description>
				</option>

				<option long-flag="force">
					<description>Force event processing even if a journal entry exists that processing has completed</description>
				</option>

				<option long-flag="expiry" flag="x" argument="hours">
					<description>Time span in hours after which objects expire from the cache (performance)</description>
				</option>

				<option long-flag="origin-id" flag="O" argument="arg">
					<description>Reprocess the origin and send a message</description>
				</option>

				<option long-flag="ep" argument="arg">
					<description>Event parameters XML file for offline processing of all contained origins (imply test option)</description>
				</option>

				<option long-flag="profile" argument="arg">
					<description>Force this profile to be used</description>
				</option>

				<option long-flag="reloc-catalog" argument="arg">
					<description>Relocate the full catalog of the passed profile and exit</description>
				</option>

				<option long-flag="dump-config">
					<description>Dump the configuration and exit</description>
				</option>
			</group>
		</command-line>
	</module>

</seiscomp>
